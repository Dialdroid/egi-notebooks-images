sudo: required
services:
- docker
jobs:
  include:
  - stage: build docker images
    script:
    - export TAG=$(if [ "x$TRAVIS_TAG" != "x" ]; then echo "$TRAVIS_TAG"; else git
      rev-parse --short HEAD; fi)
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker build -t $DOCKER_REPO/single-user single-user
    - docker tag $DOCKER_REPO/single-user $DOCKER_REPO/single-user:$TAG
    - docker build -t $DOCKER_REPO/single-user-aginfra single-user-aginfra
    - docker tag $DOCKER_REPO/single-user-aginfra $DOCKER_REPO/single-user-aginfra:$TAG
    - docker build -t $DOCKER_REPO/hub hub
    - docker tag $DOCKER_REPO/hub $DOCKER_REPO/hub:$TAG
    after_success:
    - docker push $DOCKER_REPO/single-user
    - docker push $DOCKER_REPO/single-user:$TAG
    - docker push $DOCKER_REPO/single-user-aginfra
    - docker push $DOCKER_REPO/single-user-aginfra:$TAG
    - docker push $DOCKER_REPO/hub
    - docker push $DOCKER_REPO/hub:$TAG
env:
  global:
  - DOCKER_REPO=eginotebooks
  - secure: Iq7vyskXYttgyoSjCx1c39OPwJ0tDpJrcrjBc6VbBlO5MBfiMnztpMGumgRRvltpvs/U735GrX+fcjIhrMVYGooY83rJgRjRrj7CFRTkQ+8TQAWr3VNxFZ7L8WjgIROQClxIF3W9P0x7140Oox/rtPTveGfd+WDZZhGMGf7RLTHcQ/BhXL33/C780SvIl2ph5t339y6x0h7MLvn7Imo9+DpkH3ZhKJMQyPqRDB47lgRirtPrdfX2cNwIGCYEu00TIQTcXP6LdJnP2TR8obweQhSe9koigOr3hG3thQNGui9j9ZcCnT7OS1jsjOy0tqKiH9jEMsdB2ldb39TFrXgd30y2BwAE8VMoiQyMNahjLiuj9hKu0Ve4+lYdeymtXrnEVECqrGbpPccuWSpkuICGq5VfcekXgzoaPIM0eq4ccLuS84+DYBnmZDrlkez5RtyuPf+f/JYQZf8K/exgGIOttWxYUMnVNo6zBGZy4F3KnacTAZXicQaRjTRH22H3IGVd6SVyUAsSrwzrpRPj8G6OQ4TEX7N1253YYMi/cXziiS5HEkVL7XZORYJz/pdr6inNaAA61E3R6HiZTZy7gVRGe8qZxi7AsiD2cPpqXuSxiMkRf7csE7KU1JmjcxbvwlvotTe+hOVS6322fqBrG0QFPS4wG41XfwrnhxAbL6Gcomk=
  - secure: QAomDLdpL2ckN6YQuv5/7Uut9I4PWYFXThYn29LdUcAxQAxTvxJhcUDpcJ03OkCA+dmUpNYl5g1ueQbgLa5Om9/bkq1YFXcFEI6mNbVvMPAeatclLMEQmI8SqhladiuEOaJ8GXQd4FZU5OVR3Q4sNboTCykv/asssL3v41MnxGmq1yriQdc3jYII4v8AMD5uRSpi0gdnYNCRcM3j8nf9m+g4odF7Bi2yw+/Q1saqTAbVtS9dwRYD+JmEMVtyXzqrt5jYqGwATYScbeWcgfY7Up1TKwUp948vhRgWMB8XHYc3SC83gnPJXyVGyWc8wd6IXFkYFSauYLvTdhP84+6x8jlO3mp8OyozE0TpFhlTqC+u6bcuAu2EeBX2N0wPgH/n7YKssfoBdI0FyQu5h3rmkXCQXLJTvcZw0RkG+FiD9NxAWXz/OtzUwMf/D224FkuAyFAurYbCJqoukPn2BOPrMh/UfVnnfpCxypvjtOO2KXB4ls2Wxo+sX2a+lZbMjKIbYKAkoRgL7V7gaaKVZtE8PhjPi9XekmXSfgXc706gWXOxhkFIYQCKdzYD1iCiiZ5ytfV1uLwxXsVSZow72mK1iPJ81lqPHrv5B+smFl7RADXAPCuLMC513dA8kOA5lQ2RDmxwWgFPcgtmA0gEQVEytanSAe579uulsGIjTqYKKeU=
