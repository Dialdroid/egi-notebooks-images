sudo: required
services:
- docker
jobs:
  include:
  - stage: build docker images
    script:
    - export TAG=$(if [ "x$TRAVIS_TAG" != "x" ]; then echo "$TRAVIS_TAG"; else git
      rev-parse --short HEAD; fi)
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    - docker build -t $DOCKER_REPO/single-user single-user
    - docker tag $DOCKER_REPO/single-user $DOCKER_REPO/single-user:$TAG
    - docker build -t $DOCKER_REPO/single-user-aginfra single-user-aginfra
    - docker tag $DOCKER_REPO/single-user-aginfra $DOCKER_REPO/single-user-aginfra:$TAG
    - docker build -t $DOCKER_REPO/hub hub
    - docker tag $DOCKER_REPO/hub $DOCKER_REPO/hub:$TAG
    - docker build -t $DOCKER_REPO/d4science-storage d4science-storage
    - docker tag $DOCKER_REPO/d4science-storage $DOCKER_REPO/d4science-storage:$TAG
    after_success:
    - docker push $DOCKER_REPO/single-user
    - docker push $DOCKER_REPO/single-user:$TAG
    - docker push $DOCKER_REPO/single-user-aginfra
    - docker push $DOCKER_REPO/single-user-aginfra:$TAG
    - docker push $DOCKER_REPO/hub
    - docker push $DOCKER_REPO/hub:$TAG
    - docker push $DOCKER_REPO/d4science-storage
    - docker push $DOCKER_REPO/d4science-storage:$TAG
env:
  global:
  - DOCKER_REPO=eginotebooks
  - secure: n4KBQ/+Gr/I+xoTve7CuPFnZeVjjk9gf/2B9NWY1IN8FLsfeJy/vi/Am2czf93Zynu6QWunHrf1CMXZ/PN9ra/fiSKgXbjpC+nfKI+1SK/prPNN5psNR0H8/vHV2ppLYPJOQorD0DL7w3blGPS0cSWjSAOUfUyTUhY54RAkNs615XsXIA6eTRq4d7Z7hcbWNfLaW9h79S64l9nknydsziGxAI5z9aN2TUUC1YoH8UXzNFE//f/sywtBhse9ovg644yVnCo3aecwZ/YCSkVDACDWmsxicR+YGeteyrM7kpcY2yw8M4x/bhYD9/pd0W4PxTq+A8a88oj14VnRadEwNhphh7VydE0m4MIJrwJrJTH2++4qb+q5UZPz0L9JhvjETVTqQRZw/Mfd7cHr1xE4VcfvK85KghdWXJn9QB2jtZ5RIVsxRw47xBZMJkmZH8wXl+HR7bDPLz6nx2WrEy9NEmyv8HBYIYap8pFTXw62ZK/k0K2Mj6wP8uUvsopNjnRX7+XrvmcECCwZVCyvMDFKtwvhCp2QySS/EIDwjzInZvwJK3RAJdBXtGsjltLN0ZHk9zlh7trN86Io4586jU+0K0jvTpou2eaCAaD5M07IIdoX1BxRwFL8RfCS9SvgeP+YXMrn9o/vACp8bNj4VkWAaSj1Po/KvLaWGsom5DCbo8kI=
  - secure: V6mwk0nQOgfBgiCkD8bUSRuvA1f9+bRkOcbxDnyxxo5EBSsMmcFfG9lwtd/DJcmuDiPomoaLJoJ6+bl+4w/Uytg95nPUlBtANmvF9Ksz8REk6FpRbAILCnZVJ7im4MqoTLOQKp+kFj7RwyxcmnUbqIDn8a6lwMXv4SsJ5wefblIOZC+9d+1iyCC9TrQk8PdmMotSDv1i2llYOC3OmFV/kMSK97ZwEyNotI9z3gkWGdk6L1uijgnAuXwnJvGp/A17VoXrzIFluy2KylUeoT1R2a5G4yPRQZkUI6MTlA/aowNFpdFjU5rOtIpkNeLF/WRiNI42H7sM4axJKjoJlUQnDCAXsDyq4FErsSJn8JNhEZYOGdVA1hm6LekiqOv0/+s2oFO4ovz2XlAEl72cVLUR9Bx51QlaHu9P+TcJrLWo3YmVmEE8yeTZa+JAx8sNOpihjdvKo5/kMqGkWTG8YBmoOdxFrSCFqR5L2y3fE/yc1m8X5f9InPjkA61jLfiJDOT6bXKN1OJkXFd+tedcg7BvNu4Ux0rfaTcVvX6LziLUQeaJn4d6KBFcNNwpiAVbDjJkc/bDhaPCOsLAUR7dvyTzpnS0cM6pOQR1TIP9Z6kPo6nP5c4UAYOUDC8MwXlOwZJfYmXOFl6EwFLZhfleK831cLS9JM91M2RD9UPY+ZY1A/M=
